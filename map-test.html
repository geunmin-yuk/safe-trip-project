<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì•ˆì‹¬ì—¬í–‰ ìŠ¤í…</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Kakao Maps SDK: autoload=false ë¥¼ ê¼­ ì¶”ê°€ -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=cb042192382ed6a341ff3f2649753c8f&autoload=false&libraries=services"></script>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4 max-w-6xl">
    <!-- 1. ê²€ìƒ‰ì°½ -->
    <div class="bg-white p-4 rounded-lg shadow-md mb-4">
      <h1 class="text-2xl font-bold text-green-600 mb-2">ì•ˆì‹¬ì—¬í–‰ ìŠ¤í… ğŸ—ºï¸</h1>
      <p class="text-gray-600 mb-4">ì–´ë””ë¡œ ë– ë‚˜ì‹œë‚˜ìš”? ì—¬í–‰ì§€ì˜ ì•ˆì „ ì ìˆ˜ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</p>
      <div class="flex">
        <input id="search-input" type="text" placeholder="ì˜ˆ: ì„¤ì•…ì‚° ë˜ëŠ” í•´ìš´ëŒ€"
               class="flex-grow p-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-green-500">
        <button id="search-button"
                class="bg-green-600 text-white font-bold p-2 rounded-r-lg hover:bg-green-700 w-20">ê²€ìƒ‰</button>
      </div>
    </div>

    <!-- 2. ì§€ë„ + ì •ë³´ -->
    <div class="flex flex-col md:flex-row gap-4">
      <div id="map" class="w-full md:w-2/3 bg-white rounded-lg shadow-md" style="height:500px;"></div>

      <div id="info-window" class="w-full md:w-1/3 bg-white p-4 rounded-lg shadow-md flex flex-col">
        <h2 class="text-xl font-bold mb-4 text-center">ì•ˆì „ ì •ë³´</h2>
        <div class="text-center p-4 flex-grow flex flex-col justify-center">
          <div id="score-circle"
               class="mx-auto w-32 h-32 rounded-full flex items-center justify-center text-4xl font-bold bg-gray-200 text-gray-500 transition-all duration-500">
            ?
          </div>
          <p id="score-text" class="mt-2 font-semibold text-gray-600">ì¥ì†Œë¥¼ ê²€ìƒ‰í•´ì£¼ì„¸ìš”</p>
        </div>
        <div id="info-details" class="mt-4"></div>
      </div>
    </div>
  </div>

  <!-- ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸: </body> ë°”ë¡œ ìœ„ì— ë‘ê¸° -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      kakao.maps.load(() => {
        // 1) ì§€ë„ ìƒì„±
        const mapContainer = document.getElementById('map');
        const mapOption = {
          center: new kakao.maps.LatLng(37.566826, 126.9786567),
          level: 7
        };
        const map = new kakao.maps.Map(mapContainer, mapOption);

        // 2) ë°ì´í„°/ìƒíƒœ
        let markers = [];
        const sampleData = {
          "ì„¤ì•…ì‚°": {
            lat: 38.1193, lng: 128.4659, score: 85,
            facilities: [
              { name: 'ì†ì´ˆì˜ë£Œì› (ì‘ê¸‰ì‹¤)', type: 'hospital', lat: 38.1825, lng: 128.5771 },
              { name: 'ì„¤ì•…ì‚° íƒë°©ì§€ì›ì„¼í„° AED', type: 'aed', lat: 38.1190, lng: 128.4655 },
              { name: 'ìƒˆì„œìš¸ì•½êµ­ (ì•¼ê°„ìš´ì˜)', type: 'pharmacy', lat: 38.2050, lng: 128.5912 }
            ]
          },
          "í•´ìš´ëŒ€": {
            lat: 35.1587, lng: 129.1604, score: 92,
            facilities: [
              { name: 'í•´ìš´ëŒ€ë°±ë³‘ì› (ì‘ê¸‰ì‹¤)', type: 'hospital', lat: 35.1687, lng: 129.1793 },
              { name: 'í•´ìš´ëŒ€ í•´ìˆ˜ìš•ì¥ ê´€ê´‘ì•ˆë‚´ì†Œ AED', type: 'aed', lat: 35.1580, lng: 129.1590 },
              { name: 'ëŒ€ìš°ì•½êµ­', type: 'pharmacy', lat: 35.1611, lng: 129.1623 }
            ]
          }
        };

        // 3) DOM
        const searchInput  = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const scoreCircle  = document.getElementById('score-circle');
        const scoreText    = document.getElementById('score-text');
        const infoDetails  = document.getElementById('info-details');

        // 4) ê²€ìƒ‰ ì‹¤í–‰
        function executeSearch() {
          const query = searchInput.value.trim();
          if (!query) { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

          const result = sampleData[query];
          if (!result) { alert("í•´ë‹¹ ì¥ì†Œì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\n'ì„¤ì•…ì‚°' ë˜ëŠ” 'í•´ìš´ëŒ€'ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”."); return; }

          const moveLatLng = new kakao.maps.LatLng(result.lat, result.lng);
          map.setCenter(moveLatLng);
          map.relayout(); // ë ˆì´ì•„ì›ƒ ë³€ë™ ëŒ€ì‘

          // ì ìˆ˜/ìƒ‰
          scoreCircle.textContent = result.score;
          scoreText.textContent = `${query}ì˜ ì•ˆì „ ì ìˆ˜`;
          const color = result.score >= 80 ? "bg-green-100 text-green-600"
                    : result.score >= 50 ? "bg-yellow-100 text-yellow-600"
                    : "bg-red-100 text-red-600";
          scoreCircle.className = `mx-auto w-32 h-32 rounded-full flex items-center justify-center text-4xl font-bold transition-all duration-500 ${color}`;

          // ë§ˆì»¤ ê°±ì‹ 
          markers.forEach(m => m.setMap(null)); markers = [];
          result.facilities.forEach(f => {
            const marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(f.lat, f.lng) });
            marker.setMap(map);
            markers.push(marker);
          });

          // ìƒì„¸
          infoDetails.innerHTML =
            '<h3 class="font-bold border-t pt-4 mt-4">ì£¼ìš” ì•ˆì‹¬ ì‹œì„¤</h3>' +
            '<ul class="list-disc pl-5 mt-2 text-gray-700 space-y-1">' +
            result.facilities.map(f => {
              const icon = f.type === 'hospital' ? 'ğŸš‘' : (f.type === 'aed' ? 'â¤ï¸' : 'ğŸ’Š');
              return `<li>${icon} ${f.name}</li>`;
            }).join('') +
            '</ul>';
        }

        // 5) ì´ë²¤íŠ¸
        searchButton.addEventListener('click', executeSearch);
        searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') executeSearch(); });
      });
    });
  </script>
</body>
</html>
