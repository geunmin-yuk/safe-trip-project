<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>안심여행 스텝</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Kakao Maps SDK: autoload=false 를 꼭 추가 -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=cb042192382ed6a341ff3f2649753c8f&autoload=false&libraries=services"></script>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4 max-w-6xl">
    <!-- 1. 검색창 -->
    <div class="bg-white p-4 rounded-lg shadow-md mb-4">
      <h1 class="text-2xl font-bold text-green-600 mb-2">안심여행 스텝 🗺️</h1>
      <p class="text-gray-600 mb-4">어디로 떠나시나요? 여행지의 안전 점수를 확인해보세요!</p>
      <div class="flex">
        <input id="search-input" type="text" placeholder="예: 설악산 또는 해운대"
               class="flex-grow p-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-green-500">
        <button id="search-button"
                class="bg-green-600 text-white font-bold p-2 rounded-r-lg hover:bg-green-700 w-20">검색</button>
      </div>
    </div>

    <!-- 2. 지도 + 정보 -->
    <div class="flex flex-col md:flex-row gap-4">
      <div id="map" class="w-full md:w-2/3 bg-white rounded-lg shadow-md" style="height:500px;"></div>

      <div id="info-window" class="w-full md:w-1/3 bg-white p-4 rounded-lg shadow-md flex flex-col">
        <h2 class="text-xl font-bold mb-4 text-center">안전 정보</h2>
        <div class="text-center p-4 flex-grow flex flex-col justify-center">
          <div id="score-circle"
               class="mx-auto w-32 h-32 rounded-full flex items-center justify-center text-4xl font-bold bg-gray-200 text-gray-500 transition-all duration-500">
            ?
          </div>
          <p id="score-text" class="mt-2 font-semibold text-gray-600">장소를 검색해주세요</p>
        </div>
        <div id="info-details" class="mt-4"></div>
      </div>
    </div>
  </div>

  <!-- 초기화 스크립트: </body> 바로 위에 두기 -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      kakao.maps.load(() => {
        // 1) 지도 생성
        const mapContainer = document.getElementById('map');
        const mapOption = {
          center: new kakao.maps.LatLng(37.566826, 126.9786567),
          level: 7
        };
        const map = new kakao.maps.Map(mapContainer, mapOption);

        // 2) 데이터/상태
        let markers = [];
        const sampleData = {
          "설악산": {
            lat: 38.1193, lng: 128.4659, score: 85,
            facilities: [
              { name: '속초의료원 (응급실)', type: 'hospital', lat: 38.1825, lng: 128.5771 },
              { name: '설악산 탐방지원센터 AED', type: 'aed', lat: 38.1190, lng: 128.4655 },
              { name: '새서울약국 (야간운영)', type: 'pharmacy', lat: 38.2050, lng: 128.5912 }
            ]
          },
          "해운대": {
            lat: 35.1587, lng: 129.1604, score: 92,
            facilities: [
              { name: '해운대백병원 (응급실)', type: 'hospital', lat: 35.1687, lng: 129.1793 },
              { name: '해운대 해수욕장 관광안내소 AED', type: 'aed', lat: 35.1580, lng: 129.1590 },
              { name: '대우약국', type: 'pharmacy', lat: 35.1611, lng: 129.1623 }
            ]
          }
        };

        // 3) DOM
        const searchInput  = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const scoreCircle  = document.getElementById('score-circle');
        const scoreText    = document.getElementById('score-text');
        const infoDetails  = document.getElementById('info-details');

        // 4) 검색 실행
        function executeSearch() {
          const query = searchInput.value.trim();
          if (!query) { alert("검색어를 입력해주세요."); return; }

          const result = sampleData[query];
          if (!result) { alert("해당 장소의 데이터가 없습니다.\n'설악산' 또는 '해운대'로 검색해보세요."); return; }

          const moveLatLng = new kakao.maps.LatLng(result.lat, result.lng);
          map.setCenter(moveLatLng);
          map.relayout(); // 레이아웃 변동 대응

          // 점수/색
          scoreCircle.textContent = result.score;
          scoreText.textContent = `${query}의 안전 점수`;
          const color = result.score >= 80 ? "bg-green-100 text-green-600"
                    : result.score >= 50 ? "bg-yellow-100 text-yellow-600"
                    : "bg-red-100 text-red-600";
          scoreCircle.className = `mx-auto w-32 h-32 rounded-full flex items-center justify-center text-4xl font-bold transition-all duration-500 ${color}`;

          // 마커 갱신
          markers.forEach(m => m.setMap(null)); markers = [];
          result.facilities.forEach(f => {
            const marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(f.lat, f.lng) });
            marker.setMap(map);
            markers.push(marker);
          });

          // 상세
          infoDetails.innerHTML =
            '<h3 class="font-bold border-t pt-4 mt-4">주요 안심 시설</h3>' +
            '<ul class="list-disc pl-5 mt-2 text-gray-700 space-y-1">' +
            result.facilities.map(f => {
              const icon = f.type === 'hospital' ? '🚑' : (f.type === 'aed' ? '❤️' : '💊');
              return `<li>${icon} ${f.name}</li>`;
            }).join('') +
            '</ul>';
        }

        // 5) 이벤트
        searchButton.addEventListener('click', executeSearch);
        searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') executeSearch(); });
      });
    });
  </script>
</body>
</html>
